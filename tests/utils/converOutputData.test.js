import test from 'node:test'
import assert from 'node:assert'
import { convertOutputData } from '../../src/utils/convertOutputData.mjs'

const mockData = [
    '{"id": "batch_req_67825e7004208190a8529eaee478ef22", "custom_id": "0-0", "response": {"status_code": 200, "request_id": "213187e8e4055edd698cb4645e1539d9", "body": {"id": "chatcmpl-AoUVSPwZ9PYwce4l7Hk3ahO2opKqt", "object": "chat.completion", "created": 1736597030, "model": "gpt-4o-2024-08-06", "choices": [{"index": 0, "message": {"role": "assistant", "content": "Yes.", "refusal": null}, "logprobs": null, "finish_reason": "stop"}], "usage": {"prompt_tokens": 31, "completion_tokens": 2, "total_tokens": 33, "prompt_tokens_details": {"cached_tokens": 0, "audio_tokens": 0}, "completion_tokens_details": {"reasoning_tokens": 0, "audio_tokens": 0, "accepted_prediction_tokens": 0, "rejected_prediction_tokens": 0}}, "service_tier": "default", "system_fingerprint": "fp_703d4ff298"}}, "error": null}',
    '{"id": "batch_req_67825e70129c8190a6e39ae71e5d667a", "custom_id": "0-1", "response": {"status_code": 200, "request_id": "ea8c8f65e5b45d23485e1ac4951b613c", "body": {"id": "chatcmpl-AoUVRjSXmNHh6L56kjCPnJ3SE3wQY", "object": "chat.completion", "created": 1736597029, "model": "gpt-4o-2024-08-06", "choices": [{"index": 0, "message": {"role": "assistant", "content": "Yes.", "refusal": null}, "logprobs": null, "finish_reason": "stop"}], "usage": {"prompt_tokens": 32, "completion_tokens": 3, "total_tokens": 35, "prompt_tokens_details": {"cached_tokens": 0, "audio_tokens": 0}, "completion_tokens_details": {"reasoning_tokens": 0, "audio_tokens": 0, "accepted_prediction_tokens": 0, "rejected_prediction_tokens": 0}}, "service_tier": "default", "system_fingerprint": "fp_703d4ff298"}}, "error": null}',
    '{"id": "batch_req_67825e701f548190bc83615de280ac37", "custom_id": "0-2", "response": {"status_code": 200, "request_id": "41832fe158f9249f3d4d6705906483f5", "body": {"id": "chatcmpl-AoUVOMlETMwxrn274nvevM1P2M7f9", "object": "chat.completion", "created": 1736597026, "model": "gpt-4o-2024-08-06", "choices": [{"index": 0, "message": {"role": "assistant", "content": "Yes.", "refusal": null}, "logprobs": null, "finish_reason": "stop"}], "usage": {"prompt_tokens": 33, "completion_tokens": 3, "total_tokens": 36, "prompt_tokens_details": {"cached_tokens": 0, "audio_tokens": 0}, "completion_tokens_details": {"reasoning_tokens": 0, "audio_tokens": 0, "accepted_prediction_tokens": 0, "rejected_prediction_tokens": 0}}, "service_tier": "default", "system_fingerprint": "fp_703d4ff298"}}, "error": null}',
    '{"id": "batch_req_67825e712a088190968abfc928472269", "custom_id": "1-0", "response": {"status_code": 200, "request_id": "649df41b9727cd14275b84acc7288480", "body": {"id": "chatcmpl-AoUVNjeBh5AlhcfhrM0EUIdjyVZyg", "object": "chat.completion", "created": 1736597025, "model": "gpt-4o-2024-08-06", "choices": [{"index": 0, "message": {"role": "assistant", "content": "Yes.", "refusal": null}, "logprobs": null, "finish_reason": "stop"}], "usage": {"prompt_tokens": 31, "completion_tokens": 3, "total_tokens": 34, "prompt_tokens_details": {"cached_tokens": 0, "audio_tokens": 0}, "completion_tokens_details": {"reasoning_tokens": 0, "audio_tokens": 0, "accepted_prediction_tokens": 0, "rejected_prediction_tokens": 0}}, "service_tier": "default", "system_fingerprint": "fp_703d4ff298"}}, "error": null}',
    '{"id": "batch_req_67825e71394481909bad4601a5575362", "custom_id": "1-1", "response": {"status_code": 200, "request_id": "8e7cee97facef486ba266204dacadcf8", "body": {"id": "chatcmpl-AoUVOSzemUfRXKVCEKdEKpD3WcbKV", "object": "chat.completion", "created": 1736597026, "model": "gpt-4o-2024-08-06", "choices": [{"index": 0, "message": {"role": "assistant", "content": "Yes.", "refusal": null}, "logprobs": null, "finish_reason": "stop"}], "usage": {"prompt_tokens": 32, "completion_tokens": 3, "total_tokens": 35, "prompt_tokens_details": {"cached_tokens": 0, "audio_tokens": 0}, "completion_tokens_details": {"reasoning_tokens": 0, "audio_tokens": 0, "accepted_prediction_tokens": 0, "rejected_prediction_tokens": 0}}, "service_tier": "default", "system_fingerprint": "fp_703d4ff298"}}, "error": null}',
    '{"id": "batch_req_67825e71485c81908c49fcf14455a8be", "custom_id": "1-2", "response": {"status_code": 200, "request_id": "be5b1f2f4bc851f4558c4bd7a239f075", "body": {"id": "chatcmpl-AoUVUkeeeJ0zrtAGl1709NKA9HZxd", "object": "chat.completion", "created": 1736597032, "model": "gpt-4o-2024-08-06", "choices": [{"index": 0, "message": {"role": "assistant", "content": "Yes.", "refusal": null}, "logprobs": null, "finish_reason": "stop"}], "usage": {"prompt_tokens": 33, "completion_tokens": 2, "total_tokens": 35, "prompt_tokens_details": {"cached_tokens": 0, "audio_tokens": 0}, "completion_tokens_details": {"reasoning_tokens": 0, "audio_tokens": 0, "accepted_prediction_tokens": 0, "rejected_prediction_tokens": 0}}, "service_tier": "default", "system_fingerprint": "fp_703d4ff298"}}, "error": null}',
    '{"id": "batch_req_67825e7155408190915ced8e60eb5a2a", "custom_id": "2-0", "response": {"status_code": 200, "request_id": "4df069db28dbc7e0ca612967f468f436", "body": {"id": "chatcmpl-AoUVVyO32JPUkesJSiay0OzsVhKDL", "object": "chat.completion", "created": 1736597033, "model": "gpt-4o-2024-08-06", "choices": [{"index": 0, "message": {"role": "assistant", "content": "Yes.", "refusal": null}, "logprobs": null, "finish_reason": "stop"}], "usage": {"prompt_tokens": 31, "completion_tokens": 3, "total_tokens": 34, "prompt_tokens_details": {"cached_tokens": 0, "audio_tokens": 0}, "completion_tokens_details": {"reasoning_tokens": 0, "audio_tokens": 0, "accepted_prediction_tokens": 0, "rejected_prediction_tokens": 0}}, "service_tier": "default", "system_fingerprint": "fp_703d4ff298"}}, "error": null}',
    '{"id": "batch_req_67825e7162708190891defaf67a36987", "custom_id": "2-1", "response": {"status_code": 200, "request_id": "c905ed9e117866cfac55f550d4183f9b", "body": {"id": "chatcmpl-AoUVRPQg5we4yZeiTAYtI8k5EAzFB", "object": "chat.completion", "created": 1736597029, "model": "gpt-4o-2024-08-06", "choices": [{"index": 0, "message": {"role": "assistant", "content": "Yes.", "refusal": null}, "logprobs": null, "finish_reason": "stop"}], "usage": {"prompt_tokens": 32, "completion_tokens": 3, "total_tokens": 35, "prompt_tokens_details": {"cached_tokens": 0, "audio_tokens": 0}, "completion_tokens_details": {"reasoning_tokens": 0, "audio_tokens": 0, "accepted_prediction_tokens": 0, "rejected_prediction_tokens": 0}}, "service_tier": "default", "system_fingerprint": "fp_703d4ff298"}}, "error": null}',
    '{"id": "batch_req_67825e7170448190b1d8757060ed4398", "custom_id": "2-2", "response": {"status_code": 200, "request_id": "ef08db2a06a8882c8188e45b67f57725", "body": {"id": "chatcmpl-AoUVUnjcIQtR1ifLwdh74jTNz2pB4", "object": "chat.completion", "created": 1736597032, "model": "gpt-4o-2024-08-06", "choices": [{"index": 0, "message": {"role": "assistant", "content": "Yes.", "refusal": null}, "logprobs": null, "finish_reason": "stop"}], "usage": {"prompt_tokens": 33, "completion_tokens": 2, "total_tokens": 35, "prompt_tokens_details": {"cached_tokens": 0, "audio_tokens": 0}, "completion_tokens_details": {"reasoning_tokens": 0, "audio_tokens": 0, "accepted_prediction_tokens": 0, "rejected_prediction_tokens": 0}}, "service_tier": "default", "system_fingerprint": "fp_703d4ff298"}}, "error": null}'
]

test('convertOutputData', (t) => {
    assert.strictEqual(convertOutputData(mockData, 3), 'Yes Yes Yes \nYes Yes Yes \nYes Yes Yes \n');
});